[metadata]
id = "flask-pg-dock-psyco"
version = "1.0"
title = "Flask/PostgreSQL/docker/psycopg2 test wheel"
author = "Nua testers"
tagline = "Nua test with Flask/PostgreSQL/docker/psycopg2"
website = "https://nua.rocks/"
tags = ["test", "html", "web", "static", "plugin", "PostgreSQL", "docker", "psycopg2"]
licence = "MIT"
profile = ["test"]
release = 1

[build]
document_root = "/nua/app/html"

[instance]
# PG_DATA = "toto"
# VOLUME = "titi"
resources = ["database"]
# resource1.run_env.DB_USER = "toto"

[run]
# parameters passed as a dict to docker run
auto_remove = true
# detach = true mandatory, forced

[[ports]]
container = 80

[run_env]
# parameters passed as a dict to docker run: environment dict
DB_NAME = "flask_db"
DB_USER = "bob"
DB_USER_PWD = "bob_pwd"

# additional services
[database]
type = "docker"
image = "docker.io/library/postgres:14.5"

[database.run]
    detach = true
    restart_policy.name="always"

[database.run_env]
    PGDATA = "flask_db"
    DB_USER = "bobroot"

[[database.volume]]
    # The mount type (bind / volume / tmpfs / npipe). Default: volume :
    type = "volume"
    # Name of the driver used to create the volume: (for type == "volume")
    driver = "local"
    # Mount source (e.g. a volume name or a host path):
    source = "postgres_data"
    # Container path:
    target = "/var/lib/postgresql/data"
    # mode (default to 'rw'
    mode = "rw"
