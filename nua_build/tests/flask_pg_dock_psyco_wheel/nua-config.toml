[metadata]
id = "flask-pg-dock-psyco"
version = "1.0"
title = "Flask/PostgreSQL/docker/psycopg2 test wheel"
author = "Nua testers"
tagline = "Nua test with Flask/PostgreSQL/docker/psycopg2"
website = "https://nua.rocks/"
tags = ["test", "html", "web", "static", "plugin", "PostgreSQL", "docker", "psycopg2"]
licence = "MIT"
profile = ["test"]
release = 1

[build]
document_root = "/nua/app/html"

[instance]
resources = ["database"]

[run]
# parameters passed as a dict to docker run
auto_remove = true
# detach = true mandatory, forced
restart_policy.name="always"

[[ports]]
container = 80
host = "auto"

[run_env]
# parameters passed as a dict to docker run: environment dict
DATABASE_URL="postgresql://bob:bob_pwd@postgres_data:5432/flask_db"

[database]
type = "docker"
image = "docker.io/library/postgres:14.5"

[database.run]
    detach = true
    restart_policy.name="always"

[database.run_env]
    POSTGRES_USER = "bob"
    POSTGRES_PASSWORD = "bob_pwd"
    POSTGRES_DB = "flask_db"

[[database.ports]]
    container = 5432
    host = 5432

[[database.volume]]
    # The mount type (bind / volume / tmpfs / npipe). Default: volume :
    type = "volume"
    # Name of the driver used to create the volume: (for type == "volume")
    driver = "local"
    # Mount source (e.g. a volume name or a host path):
    source = "postgres_data"
    # Container path:
    target = "/var/lib/postgresql/data"
    # mode (default to 'rw'
    mode = "rw"
