[metadata]
id = "flask-mariadb-docker-wheel"
version = "1.0"
title = "Flask/MariaDB-docker test wheel"
author = "Nua testers"
tagline = "Nua test with Flask/MariaDB-docker"
website = "https://nua.rocks/"
tags = ["test", "html", "web", "MariaDB-docker"]
licence = "MIT"
profile = ["test"]
release = 1

[build]
document_root = "/nua/app/html"

[instance]
# name of the bridge network used by this container and related resources.
network = "flask-mariadb-1"
secrets = "MARIADB_PASSWORD"

[run]
restart_policy.name="always"

[run.env]
# using default port of mariadb (3306), directly addressing the mariadb docker
# container.
# DB_HOST for the resource "mariadb" will be found in the env variable NUA_MARIADB_HOST
USER_DB = "flask_db"
USER_NAME = "bob"
USER_PASSWORD = "bob_pwd"

[port.web]
# publication port of the app inside the container
container = 80
# Publication port on the localhost, that will be automatically generated and will
# be used for configuration of the nginx proxy
host = "auto"

[[resource]]
# A resource is another container required by the main app container, its
# configuration is described below, under the key of name of the resource. Several
# resources can be declared. The resource host will appear in the local network
# with a hostname equal to the container name. The name of the resource hostname
# is available in the environment variable NUA_${name_of_the_resource}_HOST, ie in
# this example: NUA_MARIADB_HOST
name = "mariadb"
# declaration of the required image for the resurce, here the official Mariadb
# Docker image
type = "docker"
image = "docker.io/library/mariadb:10.6.10"

[resource.run]
    detach = true  # default value
    restart_policy.name = "always"


[[resource.ports]]
    # no port declaration: port declaration is required. The resource does not need to
    # expose ports on the locahost network, the main container will directly connect
    # using hostname:port of the resource through the bridge network declared as
    # ' network = "flask-mariadb-1" '

[[resource.volume]]
    # here we declare a mounted volume (ie: managed by Docker daemon)

    # The mount type (bind / volume / tmpfs / npipe). Default: volume :
    type = "volume"
    # Name of the driver used to create the volume: (for type == "volume")
    driver = "local"
    # Mount source (e.g. a volume name or a host path):
    source = "mariadb_data_1"
    # Container path:
    target = "/var/lib/mysql"
    # mode (default to 'rw'
    mode = "rw"
